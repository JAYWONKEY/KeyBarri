## 개선 사항 목록

구분	개선 포인트	적용 가능 여부	코드 위치/설명
1️⃣	TTS 마침표 중복 제거	❌ 미적용	clean_text_for_tts() 함수에 정규식 추가 필요
2️⃣	오타/비정상 입력 처리 (예: "강 ㅏㄴ돼")	❌ 미적용	main() 루프 안에서 입력값에 대한 유효성 검사 필요
3️⃣	이전 응답과 중복되는 인기메뉴 제거 / 다양화	❌ 미적용	rag_pipeline() 혹은 후처리에서 이전 응답 저장 후 비교 필요
4️⃣	TTS 말투 자연스럽게 변경	🔶 부분적용	prompt에서 “자연스럽게 말하듯이” 요청 있지만, 후처리에서 tone 조절 없음
5️⃣	불필요한 문장부호 정제 (e.g. .., !.)	❌ 미적용	clean_text_for_tts()에서 정규식 추가 필요


## 자연어 정제 위한 개선 목록

- clean_text_for_tts()에서 문장부호 정제 개선
- 유효하지 않은 입력 대응 ("대화강 ㅏㄴ돼" 같은 것)
- 동일 응답 반복 방지 or 랜덤 추천 다양화

## 소비자 입장에서 추천을 좀 더 섬세하게 하려면?"
###  1. 사용자 정보 기반 추천 로직 확장

- 기존 키오스크 내 사용자 얼굴, 몸을 통해 연령 및 기본정보 파악후 사용자의 기호나 정보에 따라 메뉴 추천

```
기존 IDEA
    키오스크 내 사용자 얼굴, 몸을 통해 연령 및 기본정보 파악후 사용자의 기호나 정보에 따라 메뉴 추천을 구상하였다.
    현재 역할은 RAG 코어 코드내 기능 개선 위주로 진행 
    기본은 키오스크.py, deepface.py 등 화면 인식 파일 같은경우에는 현재 병합 전이기에
    preprocessing.py 코드에서 관련된 RAG 코드로 위의 아이디어가 적용 진행 하려 함

    사용자 정보는 화면으로 파악하는거라서 인풋은 사용자 마음이지, 질환 정보도 개인정보라서 사람들이 말할 수 도 있고 아닐 수도 있어 그냥 하나의 정보이다.
    그런걸 키오스크가 인식하려면 길어질텐데, 키오스크 목적자체가 빠르게 주문을 도와주는 목적에 위배되서 고민 
    질병과 나이 정보 추가한거는 사실 사용자의 정보를 파악하기 위해 추천하는 하나의 로직

    어르신 뿐만아니라 키오스크에서는 어린이, 성인, 연령대 기준별로 로직이 다를텐데 그런거에 관한 추가도 필요 
```

### 기능 추가 및 개선 방향 
- 사용자의 정보를 바탕으로 한 맞춤형 추천 로직
- 사용 흐름(UX)을 해치지 않으면서도 포용적으로 정보를 활용하는 방식
 
1. 1단계: 사용자 정보 파악 (비침습적)
- DeepFace 등으로 추정한 연령대를 기반으로 기본 추천 그룹을 설정:
- 어린이 (0~12), 청소년 (13~18), 청년 (19~29), 중년 (30~49), 장년 (50~64), 노년 (65+)
- 사용자에게 “특정 질환 정보가 있다면 선택해 주세요 (선택 사항)” 식으로 UI 구성
- 고혈압 / 당뇨병 / 심장질환 / 고지혈증
- 안 고르면 그냥 연령 기반 기본 추천으로 감

2. 2단계: 사용자 정보 기반 RAG 추천 로직 설계

## 추천 UI 나누기 (GPT)
이유	설명
🧠 인지 부하 감소	모든 사용자에게 건강 정보, 질환 정보 등을 묻는 건 오히려 피로하게 느껴질 수 있어. 사용자의 상황에 따라 다르게 보여주는 게 똑똑한 UX.
🚀 속도 중심의 사용자	어떤 사용자는 그냥 빠르게 주문하고 싶어해. 그런 사람한텐 "간단 추천 받기"가 훨씬 편해.
🩺 건강 고려 사용자	질병이나 연령을 고려하고 싶은 사용자에게는 “건강 맞춤 추천” 버튼이 있는 게 훨씬 친절하고 구체적이야.
👴 연령별 시각/운영 차이	고령층은 큰 글씨, 명확한 안내, 간단한 선택을 원하고, 젊은 층은 직관적이고 빠른 선택지를 원함. 둘을 같이 묶으면 어정쩡해져.


- 실제 RAG 로직 적용 시
    - 버튼 클릭에 따른 파라미터 변경
    ```
    간단 추천
    generate_menu_recommendation(menu_df, age_group=None, diseases=None)

    ```
    ```
    건강 맞춤 추천
    generate_menu_recommendation(menu_df, age_group="노년", diseases=["고혈압", "당뇨병"])
    ```

## 1. 추천버튼 로직에 들어갈 영양소 기준 재정의 (데이터 기준) 

 1. 영양소 기준 재정의 (있는 데이터로만!)

연령대	주요 고려 요소 (데이터 기준)
어린이	단백질 (성장), 당류 적당히
청소년	단백질 (성장), 카페인 낮음
청년	카페인, 단백질, 당류
중년	지방, 포화지방, 당류
장년	나트륨, 지방, 카페인
노년	단백질, 지방 낮게, 카페인 적당

2. UI 빠른 추천 / 건강 맞춤
- 사용자 얼굴인식 -> 청소년 추정
- 버튼 : [빠른 추천] / [건강 맞춤]
- 사용자 -> [빠른 추천] 클릭

    ```
    recommended_df = filter_menu_by_health(menu_df, age_group="청소년")
    ```
- 사용자 -> [건강 맞춤] + "고혈압 있음" 체크
    ```
    recommended_df = filter_menu_by_health(menu_df, age_group="청소년", diseases=["고혈압"])

    ```
- 사용자 직접 질환 정보 선택 시 엄격하고 정밀한 필터 적용
    ```
    답변 예)
        고지혈증 있으시군요.  
        → 포화지방, 총지방 낮은 메뉴를 추천드려요.  
        👉 추천 메뉴: 아메리카노, XX 티
    ```

- [빠른 추천]
DeepFace로 연령대 추정되면,
👉 사용자가 질환 정보를 입력하지 않아도
👉 기본 연령대 기준 추천을 바로 띄워주는 것

```
    - 당신은 [청소년]으로 인식되었어요!  
    - 성장기엔 단백질과 낮은 카페인이 중요해요.  
    - 추천 메뉴: 헤이즐넛 아메리카노, XX 라떼
```

- 질병 정보 입력 귀찮다 -> 연령대 기반 빠르게 선택 유도 

### 예시용 메뉴 데이터프레임 가정
menu_df = pd.read_csv("process_data.csv")

### 빠른 추천
print(recommend_by_age(menu_df, "노년"))

### 건강 맞춤 추천
print(recommend_by_age_and_disease(menu_df, "중년", ["고혈압", "고지혈증"]))

### 개선 사항
```
    질환 정보는 선택사항 → 없으면 연령대만 반영

    연령대는 자동 추정 → 핵심 축

    UI는 두 단계 버튼 → 사용자가 얼마나 관여할지 선택

    코드 함수는 age_group, diseases만 받으면 됨

``` 

# 버튼 기반 기능별 설계 제안

1. 버튼 이름	내부 로직 연결 함수 / 설명
2. AI 서비스 이용하기	전체 flow 진입 지점 (메뉴 추천 + RAG + 구매 등)
3. 얼굴 인식	외부 모듈로 연령 추정 후 age_group 전달
4. 메뉴 추천	recommend_menu_only() 또는 filter_menu_by_health() 호출
5. AI가 답변	rag_pipeline()으로 연결
6. 구매하기	선택된 항목 가격 합산 후 반환 또는 UI 표시
7. RAG 자동 저장	RAG 응답을 파일로 저장하는 로직 추가 필요

# 다양한 포맷 지원 : CSV, PDF, Excel(xlsx)
```
pip install pandas openpyxl PyMuPDF

```


 
## 자연어 정제 및 TTS 기능
- clean_text_for_tts(): 음성 변환 전 텍스트 정제
- text_to_speech(): 텍스트를 음성으로 변환하고 재생


## 데이터 로드 및 처리
- CSV, Excel, PDF 파일 지원
- 데이터프레임에서 필요한 열(이름, 가격) 선택
- 메뉴 정보 텍스트 생성

## 맞춤형 추천 로직
- 연령대 기반 필터링 (filter_menu_by_health())
- 질환 정보 기반 필터링
- 빠른 추천과 건강 맞춤 추천 기능 구분

## RAG 파이프라인
- 임베딩 생성 및 FAISS 인덱스 활용
- Gemini API를 통한 응답 생성
- 응답 전처리 및 포맷팅

## 개선 방향 분석

- 구현완

- 사용자 정보 기반 추천 확장
- 연령대별 영양소 고려(어린이, 청소년, 청년, 중년, 장년, 노년)
- 질환별 영양소 필터링(당뇨병, 고혈압, 심장질환, 고지혈증)

## 추천 UI 분리
- recommend_by_age(): 연령 기반 빠른 추천
- recommend_by_age_and_disease(): 연령+질환 기반 건강 맞춤 추천
- recommend_menu_only(): 메뉴 이름만 간결하게 반환

## 응답 품질 개선
- 중복 응답 방지 로직
- 말투 다듬기
- 음성으로 자연스럽게 들리도록 텍스트 정제

 ## 맥락 부분에서 답답함
 1. 답변 다양성 향상
 ```
model = genai.GenerativeModel('gemini-2.0-flash')
response = model.generate_content(prompt, generation_config={
    "temperature": 0.9,
    "top_p": 0.95,
    "top_k": 40,
})

 ```
 - 예상 대화:
 “커피 말고 다른 거 뭐 있어?”

“디카페인 중에 시원한 거 추천해줘”

“가볍게 마실 거 없어?”

“오늘 같은 날씨에 잘 어울리는 거 알려줘”



#### 패키지 설치
- PyQt5 (UI)
- pandas (데이터 처리)
- numpy (수치 계산)
- faiss-cpu (벡터 검색)
- sentence-transformers (텍스트 임베딩)
- pygame (오디오 재생)
- gtts (TTS)
